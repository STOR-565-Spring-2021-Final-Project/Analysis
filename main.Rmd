---
title: "Analysis of Shopping Data"
author: "Shilong Dai, Patrick Schmitt, Puyao Ge"
output: html_notebook
---
```{r, echo=T, results="hide"}
#libraries
library(MASS)
library(e1071)
library(caret)
library(rpart)
library(doMC) 
library(popbio)
registerDoMC(cores = 11) 
```


```{r}
dat <- read.csv("./online_shoppers_intention.csv")
dat$OperatingSystems <- as.factor(dat$OperatingSystems)
dat$Browser <- as.factor(dat$Browser)
dat$Region <- as.factor(dat$Region)
dat$TrafficType <- as.factor(dat$TrafficType)
dat$Weekend <- as.factor(dat$Weekend)
set.seed(100)
train_size <- floor(0.75 * nrow(dat))
train_ind <- sample(seq_len(nrow(dat)), size = train_size)
train <- dat[train_ind, ]
test <- dat[-train_ind, ]

head(train)
```

```{r}
#visualization
logi.hist.plot(dat$ExitRates,dat$Revenue,boxp=FALSE,type="hist",col="gray")
title("Exitrate vs empirical probability of Revenue")
logi.hist.plot(dat$BounceRates,dat$Revenue,boxp=FALSE,type="hist",col="gray")
title("Bouncerate vs empirical probability of Revenue")
logi.hist.plot(dat$ProductRelated_Duration,dat$Revenue,boxp=FALSE,type="hist",col="gray")
title("ProductRelated_Duration vs empirical probability of Revenue")
logi.hist.plot(dat$ProductRelated,dat$Revenue,boxp=FALSE,type="hist",col="gray")
title("ProductRelated vs empirical probability of Revenue")
logi.hist.plot(dat$SpecialDay, dat$Revenue, boxp = FALSE, type="hist", col="gray")

mosaicplot(Region~Revenue, data=dat)
#region seems to be unimportant on its own
mosaicplot(VisitorType~Revenue, data=dat)
mosaicplot(TrafficType~Revenue, data=dat)
mosaicplot(Month~Revenue, data=dat)
```
```{r}

```


#class priors
```{r}
print(paste("Prior probability of Revenue=TRUE: ", sum(dat$Revenue==TRUE)/nrow(dat)))
print(paste("Prior probability of Revenue=FALSE: ", sum(dat$Revenue==FALSE)/nrow(dat)))
```

```{r}
train.control <- trainControl(method = "cv", number = 10)
```


```{r}
tunegrid=data.frame(C=c(0.001, 0.01, 0.25, 0.5, 1, 5, 10))
# Train the model
model.cvsvm <- train(factor(Revenue) ~., data = train, method = "svmLinear",
               trControl = train.control, tuneGrid = tunegrid)
# Summarize the results
print(model.cvsvm)
```


```{r}
#SVM WIP
model_svm = svm(factor(Revenue) ~ ., data=train, cost = 0.25, kernel = "linear")
print(model_svm)

predictions_svm = predict(model_svm, test)
table(predictions_svm, test[["Revenue"]])
```